# Заказы

## Получение списка заказов (табличное представление)

**Метод:** GET  
**URL:** `https://beta.back.erp.itecho.ru/api/tables/orders`  
**Авторизация:** Bearer token

### Параметры запроса

- `order_status_id` - ID статуса заказа из [справочника](Справочники.md#получение-списка-статусов-заказов)  
- `application_id` - ID источника заказа из [запроса]
- `page` - текущая страница (для пагинации)
- `per_page` - кол-во элементов на странице
- `query` - поисковая строка
- `date_from` - "дата с..." (от даты добавления в систему)
- `date_to` - "дата по..." (от даты добавления в систему)

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/tables/orders?query=коледино&order_status_id[]=1&application_id[]=1`

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"columns": [
		{
			"id": 26,
			"table_id": 4,
			"order": 0,
			"key": "id",
			"has_icon": 0,
			"text": "№"
		},
		{
			"id": 27,
			"table_id": 4,
			"order": 1,
			"key": "created_at",
			"has_icon": 0,
			"text": "Создан"
		},
		{
			"id": 28,
			"table_id": 4,
			"order": 2,
			"key": "branch",
			"has_icon": 1,
			"text": "Бизнес"
		},
		{
			"id": 29,
			"table_id": 4,
			"order": 3,
			"key": "counterparty",
			"has_icon": 1,
			"text": "Клиент"
		},
		{
			"id": 30,
			"table_id": 4,
			"order": 4,
			"key": "object",
			"has_icon": 1,
			"text": "Проект\/Объект"
		},
		{
			"id": 31,
			"table_id": 4,
			"order": 5,
			"key": "source",
			"has_icon": 1,
			"text": "Источник"
		},
		{
			"id": 32,
			"table_id": 4,
			"order": 6,
			"key": "manager",
			"has_icon": 1,
			"text": "Менеджер"
		},
		{
			"id": 33,
			"table_id": 4,
			"order": 7,
			"key": "sales_channel",
			"has_icon": 1,
			"text": "Канал продаж"
		},
		{
			"id": 87,
			"table_id": 4,
			"order": 8,
			"key": "promo",
			"has_icon": 1,
			"text": "Промоакция"
		},
		{
			"id": 106,
			"table_id": 4,
			"order": 9,
			"key": "price",
			"has_icon": 0,
			"text": "Сумма"
		},
		{
			"id": 107,
			"table_id": 4,
			"order": 10,
			"key": "status",
			"has_icon": 0,
			"text": "Статус\/Этап"
		}
	],
	"orders": [
		{
			"id": 16,
			"created_at": "27.07.2024 12:43",
			"branch": {
				"icon": "http:\/\/localhost:8000\/\/storage\/uploads\/9qzh2GCaYpRpaxXnql0JZYpIesu3qlvQLV2OBhcN.png",
				"value": "Продажа косметики"
			},
			"counterparty": {
				"icon": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"value": " "
			},
			"object": null,
			"source": {
				"icon": "http:\/\/localhost:8000\/\/storage\/uploads\/uPINajA2l2XPB44ojjTEd88wRKxRwsWXIlrgg2iX.jpg",
				"value": "Сей момент"
			},
			"manager": {
				"icon": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"value": "Полищук Артём"
			},
			"sales_channel": {
				"icon": "http:\/\/localhost:8000\/\/storage\/uploads\/uPINajA2l2XPB44ojjTEd88wRKxRwsWXIlrgg2iX.jpg",
				"value": "Сей момент"
			},
			"promotion": null,
			"price": null,
			"status": {
				"icon": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"value": "В сборке"
			}
		}
	],
	"pagination": {
		"total": 1,
		"per_page": 1,
		"current_page": 1,
		"last_page": 1,
		"from": 1,
		"to": 1
	}
}
```

#### Описание полей ответа

- `columns` - массив столбцов  
- `pagination` - объект с информацией, необходимой для пагинации  
- `id` - первичный ключ (номер заказа)  
- `created_at` - дата/время создания заказа  
- `branch` - объект с информацией о бизнесе  
- `counterparty` - объект с информацией о клиенте (контрагенте)  
- `object` - объект с информацией об объекте  
- `source` - объект с информацией об источнике заказа  
- `manager` - объект с информацией о менеджере  
- `sales_channel` - объект с информацией о канале продаж  
- `promotion` - объект с информацией о промоакции  
- `price` - стоимость заказа  
- `status` - объект с информацией о статусе заказа  

---

## Получение выбранного заказа

**Метод:** GET  
**URL:** `https://beta.back.erp.itecho.ru/api/orders/{id}`  
**Авторизация:** Bearer token

### Параметры запроса

Параметры не передаются.

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/orders/16`

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"order": {
		"id": 16,
		"avatar": {
			"id": 1,
			"name": "logo.svg",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "http:\/\/localhost:8000\/storage\/uploads\/yjohncMkjTSnvJ7FH4vksOtDYUy9pO2HDwmNU5Hc.svg",
			"created_at": "2024-04-14T20:04:32.000000Z",
			"updated_at": "2024-04-14T20:04:32.000000Z"
		},
		"status": {
			"id": 1,
			"name": "В сборке",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-03-27T07:00:46.000000Z"
		},
		"invoice_number": "123123",
		"invoice_start_date": "11.01.2024",
		"invoice_end_date": "11.01.2024",
		"counterparty": {
			"id": 3,
			"first_name": "",
			"last_name": "",
			"middle_name": "",
			"name": " "
		},
		"delivery_type": {
			"id": 1,
			"name": "Самовывоз",
			"price": "0.00",
			"is_active": 1,
			"created_at": "2024-05-13T05:26:37.000000Z"
		},
		"address": "г Москва, пл Комсомольская, д 20",
		"branch": {
			"id": 1,
			"name": "Продажа косметики",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/9qzh2GCaYpRpaxXnql0JZYpIesu3qlvQLV2OBhcN.png",
			"created_at": "2024-03-27T07:26:29.000000Z"
		},
		"object": {
			"id": 1,
			"name": "Wildberries",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/ypPdC9qVA2MZLbQ0l9nfS5LRlcMAVPiTBZhV31UY.svg",
			"created_at": "2024-07-27T18:15:28.000000Z"
		},
		"source": {
			"id": 10,
			"name": "Сей момент",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-06-27T07:47:12.000000Z"
		},
		"sales_channel": {
			"id": 1,
			"name": "Канал продаж 1",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-03-27T07:00:46.000000Z"
		},
		"manager": {
			"id": 1,
			"first_name": "Артём",
			"last_name": "Полищук",
			"middle_name": "Николаевич",
			"name": "Полищук Артём"
		},
		"promotion": {
			"id": 1,
			"name": "Тестовая промоакция",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/g1dGrSn4k7BnXPuwYfT0HdJDbRn8nEIPTxHRrUPy.svg",
			"created_at": "2024-07-27T18:13:40.000000Z"
		},
		"contract": {
			"id": 31,
			"name": "Карточка предприятия Nova.pdf",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "http:\/\/localhost:8000\/storage\/uploads\/p5766biHWhS7j86CCaksH87mXaaHaqZzwtieWzQM.pdf",
			"created_at": "2024-06-13T06:19:03.000000Z",
			"updated_at": "2024-06-13T06:19:03.000000Z"
		},
		"contract_number": "А-35\/2024",
		"contract_start_date": "11.01.2024",
		"contract_end_date": "11.01.2024"
	}
}
```

#### Описание полей ответа

- `id` - первичный ключ (номер заказа)  
- `avatar` - объект с информацией о фотографии заказа. Для получения информации о возвращаемых полях [см. запрос](Файлы.md#получение-выбранного-файла)  
- `status` - объект с информацией о статусе заказа. Для получения информации о возвращаемых полях [см. запрос](Справочники.md#получение-списка-статусов-заказов)	
- `invoice_number` - номер счёта 
- `invoice_start_date` - дата счёта (дата создания счёта)  
- `invoice_end_date` - дата окончания срока действия счёта
- `counterparty` - объект с информацией о контрагенте. Для получения информации о возвращаемых полях [см. запрос](Контрагенты.md#получение-списка-контагентов)
- `delivery_type` - объект с информацией о способе доставки заказа. Для получения информации о возвращаемых полях [см. запрос](Справочники.md#получение-списка-способов-доставки)	
- `address` - адрес
- `branch` - объект с информацией о бизнесе. Для получения информации о возвращаемых полях [см. запрос](Бизнесы.md#получение-выбранного-бизнеса)
- `object` - информация об объекте. Для получения информации о возвращаемых полях [см. запрос](Справочники.md#получение-списка-объектов)	
- `source` - объект с информацией об источнике заказа. Для получения информации о возвращаемых полях [см. запрос](Приложения.md#получение-списка-приложений)	
- `sales_channel` - объект с информацией о канале продаж. Для получения информации о возвращаемых полях [см. запрос](Справочники.md#получение-списка-каналов-продаж) 
- `manager` - объект с информацией о менеджере. Для получения информации о возвращаемых полях [см. запрос](Пользователи.md#получение-списка-пользователей) 
- `promotion` - объект с информацией о промоакции. Для получения информации о возвращаемых полях [см. запрос](Промоакции.md#получение-списка-промоакций)
- `contract` - объект с информацией о договоре. Для получения информации о возвращаемых полях [см. запрос](Файлы.md#получение-выбранного-файла) 
- `contract_number` - номер договора	
- `contract_start_date` - дата начала договора	
- `contract_end_date` - дата окончания договора

---

## Добавление заказа

**Метод:** POST  
**URL:** `https://beta.back.erp.itecho.ru/api/orders`  
**Авторизация:** Bearer token

### Параметры запроса

- `avatar_id` - ID фотографии склада из [справочника](Файлы.md#добавление-файла)  
- `counterparty_id` - ID контрагента из [справочника](Контрагенты.md#получение-списка-контагентов)  
- `delivery_type_id` - ID типа доставки из [справочника](Справочники.md#получение-списка-способов-доставки)
- `address` - адрес заказа, полученный из [запроса](Вспомогательные запросы.md#поиск-адресов)
- `branch_id` - ID бизнеса из [справочника](Бизнесы.md#получение-списка-бизнесов)
- `object_id` - ID объекта из [справочника](Справочники.md#получение-списка-объектов)
- `application_id` - ID источника из [справочника](Приложения.md#получение-списка-приложений)
- `sales_channel_id` - ID канала продаж из [справочника](Справочники.md#получение-списка-каналов-продаж)
- `manager_id` - ID менеджера из [справочника](Пользователи.md#получение-списка-пользователей)
- `promotion_id` - ID промоакции из [справочника](Промоакции.md#получение-списка-промоакций)
- `contract_number` - номер договора
- `contract_id` - ID договора из [справочника](Файлы.md#добавление-файла)  
- `contract_start_date` - дата начала действия договора
- `contract_end_date` - дата окончания действия договора
- `invoice_number` - номер счёта
- `invoice_start_date` - дата счёта (дата создания счёта)  
- `invoice_end_date` - дата окончания срока действия счёта

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/orders`
```json
{
	"avatar_id": 1,
	"counterparty_id": 3,
	"delivery_type_id": 1,
	"address": "г Москва, пл Комсомольская, д 20",
	"branch_id": 1,
	"object_id": null,
	"application_id": 10,
	"sales_channel_id": 1,
	"manager_id": 1,
	"promotion_id": null,
	"contract_number": "А-35/2024",
	"contract_id": 1,
	"contract_start_date": "2024-01-11",
	"contract_end_date": "2024-01-11",
	"invoice_number": "123123",
	"invoice_start_date": "2024-01-11",
	"invoice_end_date": "2024-01-11"
}
```

### Ответ

При успешном действии возвращается HTTP код `201`.
```json
{
	"order": {
		"id": 16,
		"avatar": {
			"id": 1,
			"name": "logo.svg",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "http:\/\/localhost:8000\/storage\/uploads\/yjohncMkjTSnvJ7FH4vksOtDYUy9pO2HDwmNU5Hc.svg",
			"created_at": "2024-04-14T20:04:32.000000Z",
			"updated_at": "2024-04-14T20:04:32.000000Z"
		},
		"status": {
			"id": 1,
			"name": "В сборке",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-03-27T07:00:46.000000Z"
		},
		"invoice_number": "123123",
		"invoice_start_date": "11.01.2024",
		"invoice_end_date": "11.01.2024",
		"counterparty": {
			"id": 3,
			"first_name": "",
			"last_name": "",
			"middle_name": "",
			"name": " "
		},
		"delivery_type": {
			"id": 1,
			"name": "Самовывоз",
			"price": "0.00",
			"is_active": 1,
			"created_at": "2024-05-13T05:26:37.000000Z"
		},
		"address": "г Москва, пл Комсомольская, д 20",
		"branch": {
			"id": 1,
			"name": "Продажа косметики",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/9qzh2GCaYpRpaxXnql0JZYpIesu3qlvQLV2OBhcN.png",
			"created_at": "2024-03-27T07:26:29.000000Z"
		},
		"object": {
			"id": 1,
			"name": "Wildberries",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/ypPdC9qVA2MZLbQ0l9nfS5LRlcMAVPiTBZhV31UY.svg",
			"created_at": "2024-07-27T18:15:28.000000Z"
		},
		"source": {
			"id": 10,
			"name": "Сей момент",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-06-27T07:47:12.000000Z"
		},
		"sales_channel": {
			"id": 1,
			"name": "Канал продаж 1",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-03-27T07:00:46.000000Z"
		},
		"manager": {
			"id": 1,
			"first_name": "Артём",
			"last_name": "Полищук",
			"middle_name": "Николаевич",
			"name": "Полищук Артём"
		},
		"promotion": {
			"id": 1,
			"name": "Тестовая промоакция",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/g1dGrSn4k7BnXPuwYfT0HdJDbRn8nEIPTxHRrUPy.svg",
			"created_at": "2024-07-27T18:13:40.000000Z"
		},
		"contract": {
			"id": 31,
			"name": "Карточка предприятия Nova.pdf",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "http:\/\/localhost:8000\/storage\/uploads\/p5766biHWhS7j86CCaksH87mXaaHaqZzwtieWzQM.pdf",
			"created_at": "2024-06-13T06:19:03.000000Z",
			"updated_at": "2024-06-13T06:19:03.000000Z"
		},
		"contract_number": "А-35\/2024",
		"contract_start_date": "11.01.2024",
		"contract_end_date": "11.01.2024"
	}
}
```

#### Описание полей ответа

Возвращаемые поля аналогичны [запросу](#получение-выбранного-заказа).

---

## Редактирование заказа

**Метод:** PUT  
**URL:** `https://beta.back.erp.itecho.ru/api/orders/{id}`  
**Авторизация:** Bearer token

### Параметры запроса

- `avatar_id` - ID фотографии склада из [справочника](Файлы.md#добавление-файла)  
- `counterparty_id` - ID контрагента из [справочника](Контрагенты.md#получение-списка-контагентов)  
- `delivery_type_id` - ID типа доставки из [справочника](Справочники.md#получение-списка-способов-доставки)
- `address` - адрес заказа, полученный из [запроса](Вспомогательные запросы.md#поиск-адресов)
- `branch_id` - ID бизнеса из [справочника](Бизнесы.md#получение-списка-бизнесов)
- `object_id` - ID объекта из [справочника](Справочники.md#получение-списка-объектов)
- `application_id` - ID источника из [справочника](Приложения.md#получение-списка-приложений)
- `sales_channel_id` - ID канала продаж из [справочника](Справочники.md#получение-списка-каналов-продаж)
- `manager_id` - ID менеджера из [справочника](Пользователи.md#получение-списка-пользователей)
- `promotion_id` - ID промоакции из [справочника](Промоакции.md#получение-списка-промоакций)
- `contract_number` - номер договора
- `contract_id` - ID договора из [справочника](Файлы.md#добавление-файла)  
- `contract_start_date` - дата начала действия договора
- `contract_end_date` - дата окончания действия договора
- `invoice_number` - номер счёта
- `invoice_start_date` - дата счёта (дата создания счёта)  
- `invoice_end_date` - дата окончания срока действия счёта

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/orders/1`
```json
{
	"avatar_id": 1,
	"counterparty_id": 3,
	"delivery_type_id": 1,
	"address": "г Москва, пл Комсомольская, д 20",
	"branch_id": 1,
	"object_id": null,
	"application_id": 10,
	"sales_channel_id": 1,
	"manager_id": 1,
	"promotion_id": null,
	"contract_number": "А-35/2024",
	"contract_id": 1,
	"contract_start_date": "2024-01-11",
	"contract_end_date": "2024-01-11",
	"invoice_number": "123123",
	"invoice_start_date": "2024-01-11",
	"invoice_end_date": "2024-01-11"
}
```

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"order": {
		"id": 16,
		"avatar": {
			"id": 1,
			"name": "logo.svg",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "http:\/\/localhost:8000\/storage\/uploads\/yjohncMkjTSnvJ7FH4vksOtDYUy9pO2HDwmNU5Hc.svg",
			"created_at": "2024-04-14T20:04:32.000000Z",
			"updated_at": "2024-04-14T20:04:32.000000Z"
		},
		"status": {
			"id": 1,
			"name": "В сборке",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-03-27T07:00:46.000000Z"
		},
		"invoice_number": "123123",
		"invoice_start_date": "11.01.2024",
		"invoice_end_date": "11.01.2024",
		"counterparty": {
			"id": 3,
			"first_name": "",
			"last_name": "",
			"middle_name": "",
			"name": " "
		},
		"delivery_type": {
			"id": 1,
			"name": "Самовывоз",
			"price": "0.00",
			"is_active": 1,
			"created_at": "2024-05-13T05:26:37.000000Z"
		},
		"address": "г Москва, пл Комсомольская, д 20",
		"branch": {
			"id": 1,
			"name": "Продажа косметики",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/9qzh2GCaYpRpaxXnql0JZYpIesu3qlvQLV2OBhcN.png",
			"created_at": "2024-03-27T07:26:29.000000Z"
		},
		"object": {
			"id": 1,
			"name": "Wildberries",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/ypPdC9qVA2MZLbQ0l9nfS5LRlcMAVPiTBZhV31UY.svg",
			"created_at": "2024-07-27T18:15:28.000000Z"
		},
		"source": {
			"id": 10,
			"name": "Сей момент",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-06-27T07:47:12.000000Z"
		},
		"sales_channel": {
			"id": 1,
			"name": "Канал продаж 1",
			"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
			"created_at": "2024-03-27T07:00:46.000000Z"
		},
		"manager": {
			"id": 1,
			"first_name": "Артём",
			"last_name": "Полищук",
			"middle_name": "Николаевич",
			"name": "Полищук Артём"
		},
		"promotion": {
			"id": 1,
			"name": "Тестовая промоакция",
			"avatar": "http:\/\/localhost:8000\/\/storage\/uploads\/g1dGrSn4k7BnXPuwYfT0HdJDbRn8nEIPTxHRrUPy.svg",
			"created_at": "2024-07-27T18:13:40.000000Z"
		},
		"contract": {
			"id": 31,
			"name": "Карточка предприятия Nova.pdf",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "http:\/\/localhost:8000\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "http:\/\/localhost:8000\/storage\/uploads\/p5766biHWhS7j86CCaksH87mXaaHaqZzwtieWzQM.pdf",
			"created_at": "2024-06-13T06:19:03.000000Z",
			"updated_at": "2024-06-13T06:19:03.000000Z"
		},
		"contract_number": "А-35\/2024",
		"contract_start_date": "11.01.2024",
		"contract_end_date": "11.01.2024"
	}
}
```

#### Описание полей ответа

Возвращаемые поля аналогичны [запросу](#получение-выбранного-заказа).

---

## Удаление заказа

**Метод:** DELETE  
**URL:** `https://beta.back.erp.itecho.ru/api/orders/{id}`  
**Авторизация:** Bearer token

### Параметры запроса

Параметры не передаются.

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/orders/1`

### Ответ

При успешном действии возвращается HTTP код `201`.
```json
{
	"message": "Order deleted."
}
```

#### Описание полей ответа

- `message` - информационное поле  

---