# Блоки

## Получение списка блоков (табличное представление)

**Метод:** GET  
**URL:** `https://beta.back.erp.itecho.ru/api/tables/blocks`  
**Авторизация:** Bearer token

### Параметры запроса

Параметры запроса отсутствуют

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/tables/blocks`

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"columns": [
		{
			"id": 149,
			"table_id": 19,
			"order": 0,
			"key": "id",
			"has_icon": 0,
			"text": "№"
		},
		{
			"id": 150,
			"table_id": 19,
			"order": 1,
			"key": "code",
			"has_icon": 0,
			"text": "Код"
		},
		{
			"id": 151,
			"table_id": 19,
			"order": 2,
			"key": "name",
			"has_icon": 0,
			"text": "Название"
		},
		{
			"id": 152,
			"table_id": 19,
			"order": 3,
			"key": "created_at",
			"has_icon": 0,
			"text": "Дата"
		}
	],
	"shops": [
		{
			"id": {
				"icon": null,
				"value": 1,
				"url": "https:\/\/beta.gigma.ru\/ecommerce\/orders\/order-list\/1"
			},
			"name": "Видео рекламного слайдера",
			"block_type": {
				"icon": "https:\/\/beta.api.gigma.ru\/\/storage\/uploads\/image-profile-2.svg",
				"value": "Картинка",
				"link": "https:\/\/beta.gigma.ru\/branches\/list-branches\/1"
			}
		}
	],
	"pagination": {
		"total": 1,
		"per_page": 10,
		"current_page": 1,
		"last_page": 1,
		"from": 1,
		"to": 1
	}
}
```

#### Описание полей ответа

- `columns` - массив столбцов  
- `pagination` - объект с информацией, необходимой для пагинации  
- `id` - первичный ключ (номер заказа)  
- `name` - название блока    
- `block_type` - объект с информацией о типе блока    

---

## Получение списка блоков

**Метод:** GET  
**URL:** `https://beta.back.erp.itecho.ru/api/blocks`  
**Авторизация:** Bearer token

### Параметры запроса

Параметры запроса отсутствуют

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/blocks`

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"blocks": {
		"current_page": 1,
		"data": [
			{
				"id": 9,
				"code": 6,
				"name": "Видео рекламного слайдера",
				"block_type": {
					"id": 3,
					"name": "Картинка",
					"avatar": "https:\/\/beta.api.gigma.ru\/\/storage\/uploads\/image-profile-2.svg",
					"created_at": "2025-01-23T09:47:38.000000Z"
				},
				"link": "https:\/\/rutube.ru\/video\/914bf2c61bd1af4252ce22ac9980ae6d\/",
				"file": {
					"id": 1,
					"name": "logo.svg",
					"type": {
						"id": 1,
						"name": "Трудовой договор",
						"avatar": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/default.svg",
						"created_at": "2024-03-27T07:00:46.000000Z"
					},
					"path": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/yjohncMkjTSnvJ7FH4vksOtDYUy9pO2HDwmNU5Hc.svg",
					"link": null,
					"created_at": "2024-04-14T20:04:32.000000Z",
					"updated_at": "2024-04-14T20:04:32.000000Z"
				},
				"text": "Привет, мир!",
				"parent": null,
				"children": [],
				"created_at": "2025-01-23T15:51:41.000000Z"
			}
		],
		"first_page_url": "http:\/\/192.168.0.43:8000\/blocks?page=1",
		"from": 1,
		"last_page": 1,
		"last_page_url": "http:\/\/192.168.0.43:8000\/blocks?page=1",
		"links": [
			{
				"url": null,
				"label": "&laquo; Предыдущая",
				"active": false
			},
			{
				"url": "http:\/\/192.168.0.43:8000\/blocks?page=1",
				"label": "1",
				"active": true
			},
			{
				"url": null,
				"label": "Следующая &raquo;",
				"active": false
			}
		],
		"next_page_url": null,
		"path": "http:\/\/192.168.0.43:8000\/blocks",
		"per_page": 10,
		"prev_page_url": null,
		"to": 1,
		"total": 1
	}
}
```

#### Описание полей ответа

Возвращаемые поля аналогичны [запросу](#получение-выбранного-блока)

---

## Получение выбранного блока

**Метод:** GET  
**URL:** `https://beta.back.erp.itecho.ru/api/blocks/{id}`  
**Авторизация:** Bearer token

### Параметры запроса

Параметры не передаются.

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/blocks/9`

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"block": {
		"id": 1,
		"code": 1,
		"name": "Видео рекламного слайдера",
		"block_type": {
			"id": 3,
			"name": "Картинка",
			"avatar": "https:\/\/beta.api.gigma.ru\/\/storage\/uploads\/image-profile-2.svg",
			"created_at": "2025-01-23T09:47:38.000000Z"
		},
		"link": "https:\/\/rutube.ru\/video\/914bf2c61bd1af4252ce22ac9980ae6d\/",
		"file": {
			"id": 1,
			"name": "logo.svg",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/yjohncMkjTSnvJ7FH4vksOtDYUy9pO2HDwmNU5Hc.svg",
			"link": null,
			"created_at": "2024-04-14T20:04:32.000000Z",
			"updated_at": "2024-04-14T20:04:32.000000Z"
		},
		"text": "Привет, мир!",
		"children": [
			{
				"id": 2,
				"code": 2,
				"name": "Видео рекламного слайдера",
				"block_type": {
					"id": 3,
					"name": "Картинка",
					"avatar": "https:\/\/beta.api.gigma.ru\/\/storage\/uploads\/image-profile-2.svg",
					"created_at": "2025-01-23T09:47:38.000000Z"
				},
				"link": null,
				"file": {
					"id": 2,
					"name": "logo.png",
					"type": {
						"id": 1,
						"name": "Трудовой договор",
						"avatar": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/default.svg",
						"created_at": "2024-03-27T07:00:46.000000Z"
					},
					"path": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/igbcW8dPebcrVfnbC2A2Zptf1nruFcF8Nmf8sVTG.png",
					"link": null,
					"created_at": "2024-04-14T20:11:00.000000Z",
					"updated_at": "2024-04-14T20:11:00.000000Z"
				},
				"text": null,
				"children": [],
				"created_at": "2025-01-23T17:44:00.000000Z"
			}
		],
		"created_at": "2025-01-23T15:57:33.000000Z"
	}
}
```

#### Описание полей ответа

- `id` - первичный ключ (номер блока)  
- `code` - код блока  
- `name` - название блока	
- `block_type` - объект с информацией о типе блока. Для получения информации о возвращаемых полях [см. запрос](Справочники.md#получение-списка-типов-блоков)	
- `link` - URL ссылка  
- `file` - объект с информацией о прикреплённом файле. Для получения информации о возвращаемых полях [см. запрос](Файлы.md#получение-выбранного-файла)	
- `text` - текстовый контент блока	
- `children` - массив объектов типа "Блок", которые являются подчиненными сущностями выбранного элемента	
- `created_at` - дата добавления в систему	

---

## Добавление блока

**Метод:** POST  
**URL:** `https://beta.back.erp.itecho.ru/api/blocks`  
**Авторизация:** Bearer token

### Параметры запроса

- `block_type_id` - ID типа блока из [справочника](Справочники.md#получение-списка-типов-блоков)  
- `name` - имя блока
- `link` - URL ссылка. Обязателен, если block_type_id = 4 или block_type_id = 5	
- `file_id` - ID прикрепляемого файла, загруженного при помощи [запроса](Файлы.md#добавление-файла). Обязателен, если block_type_id = 3	
- `text` - текстовый контент блока.	Обязателен, если block_type_id = 1 или block_type_id = 2	
- `parent_id` - ID родительского блока из [запроса](Блоки.md#получение-списка-блоков)	

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/blocks`
```json
{
	"block_type_id": 3,
	"name": "Параметр 1",
	"link": null,
	"file_id": 1,
	"text": null,
	"parent_id": 1
}
```

### Ответ

При успешном действии возвращается HTTP код `201`.
```json
{
	"block": {
		"id": 5,
		"code": 5,
		"name": "Параметр 1",
		"block_type": {
			"id": 3,
			"name": "Картинка",
			"avatar": "https:\/\/beta.api.gigma.ru\/\/storage\/uploads\/image-profile-2.svg",
			"created_at": "2025-01-23T09:47:38.000000Z"
		},
		"link": null,
		"file": {
			"id": 1,
			"name": "logo.svg",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/yjohncMkjTSnvJ7FH4vksOtDYUy9pO2HDwmNU5Hc.svg",
			"link": null,
			"created_at": "2024-04-14T20:04:32.000000Z",
			"updated_at": "2024-04-14T20:04:32.000000Z"
		},
		"text": null,
		"parent": {
			"id": 1,
			"name": "Видео рекламного слайдера"
		},
		"children": [],
		"created_at": "2025-01-23T17:59:03.000000Z"
	}
}
```

#### Описание полей ответа

Возвращаемые поля аналогичны [запросу](#получение-выбранного-блока).

---

## Редактирование блока

**Метод:** PUT  
**URL:** `https://beta.back.erp.itecho.ru/api/blocks/{id}`  
**Авторизация:** Bearer token

### Параметры запроса

- `block_type_id` - ID типа блока из [справочника](Справочники.md#получение-списка-типов-блоков)  
- `name` - имя блока  
- `code` - код блока  
- `link` - URL ссылка. Обязателен, если block_type_id = 4 или block_type_id = 5	
- `file_id` - ID прикрепляемого файла, загруженного при помощи [запроса](Файлы.md#добавление-файла). Обязателен, если block_type_id = 3	
- `text` - текстовый контент блока.	Обязателен, если block_type_id = 1 или block_type_id = 2	
- `parent_id` - ID родительского блока из [запроса](Блоки.md#получение-списка-блоков)	

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/orders/17`
```json
{
	"block_type_id": 3,
	"name": "Видео рекламного слайдера",
	"file_id": 2,
	"parent_id": 1,
	"code": 10
}
```

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"block": {
		"id": 2,
		"code": 10,
		"name": "Видео рекламного слайдера",
		"block_type": {
			"id": 3,
			"name": "Картинка",
			"avatar": "https:\/\/beta.api.gigma.ru\/\/storage\/uploads\/image-profile-2.svg",
			"created_at": "2025-01-23T09:47:38.000000Z"
		},
		"link": null,
		"file": {
			"id": 2,
			"name": "logo.png",
			"type": {
				"id": 1,
				"name": "Трудовой договор",
				"avatar": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/default.svg",
				"created_at": "2024-03-27T07:00:46.000000Z"
			},
			"path": "https:\/\/beta.api.gigma.ru\/storage\/uploads\/igbcW8dPebcrVfnbC2A2Zptf1nruFcF8Nmf8sVTG.png",
			"link": null,
			"created_at": "2024-04-14T20:11:00.000000Z",
			"updated_at": "2024-04-14T20:11:00.000000Z"
		},
		"text": null,
		"parent": {
			"id": 1,
			"name": "Видео рекламного слайдера"
		},
		"children": [],
		"created_at": "2025-01-23T17:44:00.000000Z"
	}
}
```

#### Описание полей ответа

Возвращаемые поля аналогичны [запросу](#получение-выбранного-блока).

---

## Удаление блока

**Метод:** DELETE  
**URL:** `https://beta.back.erp.itecho.ru/api/blocks/{id}`  
**Авторизация:** Bearer token

### Параметры запроса

Параметры не передаются.

### Пример запроса  

`https://beta.back.erp.itecho.ru/api/blocks/1`

### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"message": "Block successfully deleted"
}
```

#### Описание полей ответа

- `message` - информационное поле  

---

## История изменений

### Получение истории изменений по блоку

**Метод:** GET  
**URL:** `https://beta.back.erp.itecho.ru/api/blocks/{id}/history`  
**Авторизация:** Bearer token

#### Параметры запроса

Параметры не передаются.

#### Пример запроса  

`https://beta.back.erp.itecho.ru/api/blocks/18/history`

#### Ответ

При успешном действии возвращается HTTP код `200`.
```json
{
	"histories": [
		{
			"id": 2174,
			"icon": "check",
			"color": "primary",
			"title": "Создание",
			"description": "Создание: Воронова София",
			"datetime": "23.01.2025 15:57"
		}
	],
	"historiesCount": 1
}
```

##### Описание полей ответа

- `id` - первичный ключ
- `icon` - иконка
- `color` - цвет
- `title` - заголовок
- `description` - описание
- `datetime` - дата выполнения действия
